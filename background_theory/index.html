<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Theory - pyHRMC</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/fontawesome.min.css" rel="stylesheet">
        <link href="../css/brands.min.css" rel="stylesheet">
        <link href="../css/solid.min.css" rel="stylesheet">
        <link href="../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/docco.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <link href="../css/extra.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">pyHRMC</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item">
                                <a href="../installation/" class="nav-link">Installation</a>
                            </li>
                            <li class="nav-item">
                                <a href="./" class="nav-link active" aria-current="page">Theory</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">User Guide</a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Getting started</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../user_guide/getting_started/required_files/" class="dropdown-item">Required files</a>
</li>
            
<li>
    <a href="../user_guide/getting_started/runfile_setup/" class="dropdown-item">Runfile setup</a>
</li>
            
<li>
    <a href="../user_guide/getting_started/lammps_input/" class="dropdown-item">LAMMPS input files</a>
</li>
            
<li>
    <a href="../user_guide/getting_started/outputs/" class="dropdown-item">Understanding outputs</a>
</li>
    </ul>
  </li>
                                    
<li>
    <a href="../user_guide/validator_selection/" class="dropdown-item">Validator selection</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Additional choices</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../user_guide/nonhybrid_setup/" class="dropdown-item">Non-hybrid simulations</a>
</li>
            
<li>
    <a href="../user_guide/bulk_vs_slab/" class="dropdown-item">Bulk vs slab cells</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../installation/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../user_guide/getting_started/required_files/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#theory" class="nav-link">Theory</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#monte-carlo-and-loss-function" class="nav-link">Monte Carlo and loss function</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#hybrid-reverse-monte-carlo-hrmc" class="nav-link">Hybrid Reverse Monte Carlo (HRMC)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#quench-schemes" class="nav-link">Quench schemes</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="theory">Theory</h1>
<h2 id="monte-carlo-and-loss-function">Monte Carlo and loss function</h2>
<p>The H/RMC algorithm employs the Metropolis Markov chain Monte Carlo method to stochastically sample atomistic configurations of a structure. The simulations converge by minimizing a loss function, which follows the general form:</p>
<div class="arithmatex">\[
\chi^{2}_{total} = \sum_{i}^{n} \sum_{j} \frac{(A_{i}(j)_{target} - A_{i}(j)_{calc})^{2}} {W_{i}} .
\]</div>
<p>Here, the total loss <span class="arithmatex">\(\chi^{2}_{total}\)</span> is summed over the <em>n</em> constraints that guide the simulation. Each term in the loss function represents a squared difference between the calculated value <em><span class="arithmatex">\(A_{calc}\)</span></em> and the target value <em><span class="arithmatex">\(A_{target}\)</span></em>, scaled by a weight term <em><span class="arithmatex">\(W_{i}\)</span></em>. The number of terms in this function depends on the constraints that are defined by the user. Typically, in RMC simulations, this loss function includes an error term that fits the calculated pair distribution function (PDF) to experimental PDF data </p>
<div class="arithmatex">\[
\chi^{2}_{error} = \sum_{i}^{n_{bin}}\frac{(G(r_{i})_{target} - G(r_{i})_{calc})^{2}} {\sigma_{}} .
\]</div>
<p>where the squared difference between the experimental/target PDF <span class="arithmatex">\(G(r)_{target}\)</span> and the calculated PDF <span class="arithmatex">\(G(r)_{calc}\)</span> of the Monte Carlo structure is scaled with <em><span class="arithmatex">\(\sigma\)</span></em>, the experimental error that acts as the weight term, and is summed over <span class="arithmatex">\(n_{bin}\)</span>, the number of bins of <span class="arithmatex">\(G(r)_{target}\)</span>. </p>
<p>In pyHRMC, the PDF is always assumed to be the electron pair distribution function (ePDF). This distinction is critical because the scattering cross-sections used to calculate the theoretical electron scattering—and, consequently, the PDF—depend on the ePDF of the simulated structure.</p>
<p>While RMC is effective at matching a structure's calculated ePDF to experimental data, it cannot produce a unique solution. In other words, RMC may arrive at one of many different atomistic configurations can produce approximately the same ePDF. . This ambiguity can be somewhat mitigated by choosing simulation cells large enough to yield a statistically robust distribution of coordination environments. However, under-constrained RMC simulations may still produce unrealistic configurations.</p>
<h2 id="hybrid-reverse-monte-carlo-hrmc">Hybrid Reverse Monte Carlo (HRMC)</h2>
<p>To address this limitation, HRMC was introduced by Opletal et al. in 2002 (see ref 1). In HRMC, an additional energy term is included in the total loss function, leading to the following form:</p>
<div class="arithmatex">\[
\chi^{2}_{total} = \chi^{2}_{error} + \frac { \Delta E} {k_{B}T}
\]</div>
<p>Similar to the error term, the energy term is scaled by a temperature variable (T). This addition results in a Boltzmann-type probability distribution, where the algorithm may accept a step even when the energy loss term increases.</p>
<p><strong>BUG</strong>
The program will always accept the proposed Monte Carlo step if the new loss value <span class="arithmatex">\(\chi^{2}_{new}\)</span> is less than old loss value <span class="arithmatex">\(\chi^{2}_{old}\)</span>. Otherwise, the probability of accepting a move is:</p>
<div class="arithmatex">\[
P = e^{\chi^{2}_{old} - \chi^{2}_{new}}
\]</div>
<h2 id="quench-schemes">Quench schemes</h2>
<p>As noted above, the weight term in each loss function affects the Boltzmann-type probability distribution of accepting a "worse" step. In traditional RMC, where the PDF error term is the sole contributor to the loss function <span class="arithmatex">\(\chi^{2}_{total}\)</span>, this weight <span class="arithmatex">\(\sigma\)</span> is typically kept static throughout the simulation. However, initializing the simulation with greater weight terms and gradually reducing them can help optimize convergence. This approach allows the structure to explore a broader structural space early on while still refining toward a low loss value as the simulation progresses.</p>
<p>This following quenching scheme was introduced by Opletal et al. and has been implemented in pyHRMC:</p>
<div class="arithmatex">\[
T_{n+1} = T_{n} * q_{T}^{n} 
\]</div>
<div class="arithmatex">\[
\sigma_{n+1} = \sigma_{n} * q_{\sigma}^{n} ,
\]</div>
<p>where n is the number of steps in millions, and q is a quenching parameter between 0-1. Because H/RMC is performed over millions of steps and gradual quenching is necessary for proper convergence, q is typically very close to 1.</p>
<p>When selecting values for these quenching parameters in pyHRMC, note the distinction between a <a href="https://ehrhardtkm.github.io/pyHRMC/runfile_setup/">step and an iteration</a>. Quenching will occur after each <em>iteration</em>, so greater parallelization will result in a slightly coarser quenching scheme.</p>
<hr />
<p>For further details and examples in the literature, we suggest the following references:</p>
<ol>
<li><a href="https://www.tandfonline.com/doi/abs/10.1080/089270204000002584?casa_token=Il9_dIbtCoIAAAAA:FSzPAgSfbQ2FLkG7_C5VcxNbZhqkeCQJLu-GlYR4s9L090xkQ5KbigcF8idYFZ56FoHBulHD11TD">Opletal, G., Petersen, T., O’Malley, B., Snook, I., McCulloch, D. G., Marks, N. A., &amp; Yarovsky, I. Hybrid approach for generating realistic amorphous carbon structure using metropolis and reverse Monte Carlo. Molecular Simulation, 2002, 28(10–11), 927–938. https://doi.org/10.1080/089270204000002584</a></li>
<li><a href="https://www.sciencedirect.com/science/article/pii/S0010465508000039">G. Opletal, T.C. Petersen, B. O'Malley, I.K. Snook, D.G. McCulloch, I. Yarovsky. HRMC: Hybrid Reverse Monte Carlo method with silicon and carbon potentials. Comput. Phys. Commun., 2008, 178 (10), 777-787. https://doi.org/10.1016/j.cpc.2007.12.007.</a></li>
<li><a href="https://www.sciencedirect.com/science/article/pii/S0008622314010859">Amir H. Farmahini, Suresh K. Bhatia. Hybrid Reverse Monte Carlo simulation of amorphous carbon: Distinguishing between competing structures obtained using different modeling protocols. Carbon, 2015, 83, 53-70. https://doi.org/10.1016/j.carbon.2014.11.013.</a></li>
</ol></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../javascripts/mathjax.js"></script>
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
